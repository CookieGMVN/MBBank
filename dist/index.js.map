{"version":3,"sources":["../src/index.ts","../src/MB.ts","../src/utils/Global.ts","../src/utils/LoadWasm.ts","../src/utils/OCRModel.ts","../src/utils/Tesseract.ts","../src/utils/Wasm.ts"],"sourcesContent":["/*\r\n * MIT License\r\n *\r\n * Copyright (c) 2024 CookieGMVN and contributors\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to deal\r\n * in the Software without restriction, including without limitation the rights\r\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n * copies of the Software, and to permit persons to whom the Software is\r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\nimport MB from \"./MB\";\r\n\r\nexport { MB };","/*\r\n * MIT License\r\n *\r\n * Copyright (c) 2024 CookieGMVN and contributors\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to deal\r\n * in the Software without restriction, including without limitation the rights\r\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n * copies of the Software, and to permit persons to whom the Software is\r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\nimport { createHash } from \"node:crypto\";\r\n\r\nimport moment from \"moment\";\r\nimport { Client } from \"undici\";\r\n\r\nimport { BalanceData, BalanceList, LoginResponseData, TransactionInfo } from \"./typings/MBApi\";\r\nimport { CaptchaResponse } from \"./typings/MBLogin\";\r\nimport { defaultHeaders, FPR, generateDeviceId, getTimeNow } from \"./utils/Global\";\r\nimport wasmEnc from \"./utils/LoadWasm\";\r\nimport OCRModel from \"./utils/OCRModel\";\r\nimport TesseractUtils from \"./utils/Tesseract\";\r\nimport WasmUtils from \"./utils/Wasm\";\r\n\r\n/**\r\n * Main client class for MB Bank API integration.\r\n * Provides functionality for authentication, account balance queries, and transaction history.\r\n *\r\n * @example\r\n * ```typescript\r\n * // Initialize the MB client\r\n * const mb = new MB({\r\n *   username: '0123456789',   // Your MB Bank phone number\r\n *   password: 'your_password' // Your MB Bank password\r\n * });\r\n *\r\n * // Login and get account balance\r\n * async function checkBalance() {\r\n *   await mb.login();\r\n *   const balance = await mb.getBalance();\r\n *   console.log('Total balance:', balance.totalBalance);\r\n *   console.log('Accounts:', balance.balances);\r\n * }\r\n *\r\n * checkBalance().catch(console.error);\r\n * ```\r\n */\r\nexport default class MB {\r\n    /**\r\n     * MB Bank account username (usually phone number).\r\n     * @readonly\r\n     * @type {string}\r\n     */\r\n    public readonly username: string;\r\n\r\n    /**\r\n     * MB Bank account password.\r\n     * @readonly\r\n     * @type {string}\r\n     */\r\n    public readonly password: string;\r\n\r\n    /**\r\n     * Session identifier returned by MB Bank's API after successful authentication.\r\n     * Used to validate subsequent requests.\r\n     * @type {string|null|undefined}\r\n     */\r\n    public sessionId: string | null | undefined;\r\n\r\n    /**\r\n     * Device identifier used for authentication with MB Bank API.\r\n     * This is automatically generated for each session.\r\n     * @type {string}\r\n     */\r\n    public deviceId: string = generateDeviceId();\r\n\r\n    /**\r\n     * HTTP client for making requests to MB Bank's API.\r\n     * @type {Client}\r\n     */\r\n    public client = new Client(\"https://online.mbbank.com.vn\");\r\n\r\n    /**\r\n     * WASM binary data downloaded from MB Bank.\r\n     * Used for request encryption.\r\n     * @private\r\n     * @type {Buffer}\r\n     */\r\n    private wasmData!: Buffer;\r\n\r\n    /**\r\n     * Custom OCR function for captcha recognition.\r\n     * Allows implementing your own captcha recognition logic.\r\n     *\r\n     * @private\r\n     * @type {Function|undefined}\r\n     * @param {Buffer} image - The captcha image buffer to be recognized\r\n     * @returns {Promise<string>} Recognized text from the captcha\r\n     *\r\n     * @example\r\n     * ```typescript\r\n     * const mb = new MB({\r\n     *   username: '0123456789',\r\n     *   password: 'your_password',\r\n     *   preferredOCRMethod: 'custom',\r\n     *   customOCRFunction: async (imageBuffer) => {\r\n     *     // Your custom OCR logic here\r\n     *     // For example, using a third-party OCR service:\r\n     *     const result = await someOCRService.recognize(imageBuffer);\r\n     *     return result.text;\r\n     *   }\r\n     * });\r\n     * ```\r\n     */\r\n    private customOCRFunction?: (image: Buffer) => Promise<string>;\r\n\r\n    /**\r\n     * The OCR method to use for captcha recognition.\r\n     * - \"default\": Uses the pre-trained OCR model (recommended)\r\n     * - \"tesseract\": Uses Tesseract OCR engine\r\n     * - \"custom\": Uses the custom OCR function provided\r\n     *\r\n     * @private\r\n     * @type {\"default\"|\"tesseract\"|\"custom\"}\r\n     * @default \"default\"\r\n     */\r\n    private preferredOCRMethod: \"default\" | \"tesseract\" | \"custom\" = \"default\";\r\n\r\n    /**\r\n     * Whether to save the WASM file to disk.\r\n     * Useful for debugging or caching purposes.\r\n     *\r\n     * @private\r\n     * @type {boolean}\r\n     * @default false\r\n     */\r\n    private saveWasm: boolean = false;\r\n\r\n    /**\r\n     * Creates a new MB client instance.\r\n     *\r\n     * @param {Object} data - Configuration options\r\n     * @param {string} data.username - MB Bank login username (usually your registered phone number)\r\n     * @param {string} data.password - MB Bank login password\r\n     * @param {\"default\"|\"tesseract\"|\"custom\"} [data.preferredOCRMethod=\"default\"] - OCR method for captcha recognition\r\n     * @param {Function} [data.customOCRFunction] - Custom OCR function (required if preferredOCRMethod is \"custom\")\r\n     * @param {boolean} [data.saveWasm=false] - Whether to save the WASM file to disk\r\n     *\r\n     * @throws {Error} If username or password is not provided\r\n     *\r\n     * @example\r\n     * ```typescript\r\n     * // Basic usage with default OCR\r\n     * const mbClient = new MB({\r\n     *   username: '0123456789',\r\n     *   password: 'your_password'\r\n     * });\r\n     *\r\n     * // Using Tesseract OCR\r\n     * const mbWithTesseract = new MB({\r\n     *   username: '0123456789',\r\n     *   password: 'your_password',\r\n     *   preferredOCRMethod: 'tesseract'\r\n     * });\r\n     *\r\n     * // Using custom OCR function\r\n     * const mbWithCustomOCR = new MB({\r\n     *   username: '0123456789',\r\n     *   password: 'your_password',\r\n     *   preferredOCRMethod: 'custom',\r\n     *   customOCRFunction: async (image) => {\r\n     *     // Your custom captcha recognition logic\r\n     *     return recognizedText;\r\n     *   }\r\n     * });\r\n     * ```\r\n     */\r\n    public constructor(data: {\r\n        username: string,\r\n        password: string,\r\n        preferredOCRMethod?: \"default\" | \"tesseract\" | \"custom\",\r\n        customOCRFunction?: (image: Buffer) => Promise<string>,\r\n        saveWasm?: boolean\r\n    }) {\r\n        if (!data.username || !data.password) throw new Error(\"You must define at least a MB account to use with this library!\");\r\n\r\n        this.username = data.username;\r\n        this.password = data.password;\r\n\r\n        if (data.preferredOCRMethod) this.preferredOCRMethod = data.preferredOCRMethod;\r\n        if (data.customOCRFunction) this.customOCRFunction = data.customOCRFunction;\r\n        if (data.saveWasm) this.saveWasm = data.saveWasm;\r\n    }\r\n\r\n    /**\r\n     * Processes captcha image according to the configured OCR method.\r\n     *\r\n     * @private\r\n     * @param {Buffer} image - Captcha image buffer\r\n     * @returns {Promise<string|null>} Recognized captcha text or null if recognition failed\r\n     */\r\n    private async recognizeCaptcha(image: Buffer) {\r\n        switch (this.preferredOCRMethod) {\r\n            case \"default\":\r\n                // eslint-disable-next-line no-case-declarations\r\n                const model = new OCRModel();\r\n                await model.loadModel();\r\n\r\n                // eslint-disable-next-line no-case-declarations\r\n                const modelPredictedCaptcha = await model.predict(image);\r\n\r\n                if (modelPredictedCaptcha.length !== 6) return null;\r\n                return modelPredictedCaptcha;\r\n            case \"tesseract\":\r\n                return await TesseractUtils.recognizeText(image);\r\n            case \"custom\":\r\n                if (!this.customOCRFunction) return null;\r\n\r\n                // eslint-disable-next-line no-case-declarations\r\n                const customPredictedCaptcha = await this.customOCRFunction(image);\r\n\r\n                if (customPredictedCaptcha.length !== 6) return null;\r\n                return customPredictedCaptcha;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Authenticates with MB Bank API by solving captcha and sending login credentials.\r\n     * Sets the session ID upon successful login.\r\n     *\r\n     * @returns {Promise<LoginResponseData>} Login response from the API\r\n     * @throws {Error} If login fails with specific error code and message\r\n     *\r\n     * @example\r\n     * ```typescript\r\n     * const mb = new MB({\r\n     *   username: '0123456789',\r\n     *   password: 'your_password'\r\n     * });\r\n     *\r\n     * try {\r\n     *   const loginResponse = await mb.login();\r\n     *   console.log('Login successful!');\r\n     *   console.log('Session ID:', mb.sessionId);\r\n     * } catch (error) {\r\n     *   console.error('Login failed:', error.message);\r\n     * }\r\n     * ```\r\n     */\r\n    public async login(): Promise<LoginResponseData> {\r\n        // Request ID/Ref ID for MB\r\n        const rId = getTimeNow();\r\n\r\n        const headers = defaultHeaders as any;\r\n        headers[\"X-Request-Id\"] = rId;\r\n        headers[\"Deviceid\"] = this.deviceId;\r\n        headers[\"Refno\"] = rId;\r\n\r\n        const captchaReq = await this.client.request({\r\n            method: \"POST\",\r\n            path: \"/api/retail-internetbankingms/getCaptchaImage\",\r\n            headers,\r\n            body: JSON.stringify({\r\n                \"sessionId\": \"\",\r\n                \"refNo\": rId,\r\n                \"deviceIdCommon\": this.deviceId,\r\n            }),\r\n        });\r\n\r\n        const captchaRes: CaptchaResponse = await captchaReq.body.json() as CaptchaResponse;\r\n        const captchaBuffer = Buffer.from(captchaRes.imageString, \"base64\");\r\n\r\n        const captchaContent = await this.recognizeCaptcha(captchaBuffer);\r\n\r\n        if (captchaContent === null) return this.login();\r\n\r\n        // wasm\r\n        if (!this.wasmData) {\r\n            this.wasmData = await WasmUtils.loadWasm(this.saveWasm ? \"main.wasm\" : undefined);\r\n        }\r\n\r\n        // Create Data\r\n        const requestData = {\r\n            userId: this.username,\r\n            password: createHash(\"md5\").update(this.password).digest(\"hex\"),\r\n            captcha: captchaContent,\r\n            ibAuthen2faString: FPR,\r\n            sessionId: null,\r\n            refNo: getTimeNow(),\r\n            deviceIdCommon: this.deviceId,\r\n        };\r\n\r\n        const loginReq = await this.client.request({\r\n            method: \"POST\",\r\n            path: \"/api/retail_web/internetbanking/v2.0/doLogin\",\r\n            headers: defaultHeaders,\r\n            body: JSON.stringify({\r\n                dataEnc: await wasmEnc(this.wasmData, requestData, \"0\"),\r\n            }),\r\n        });\r\n\r\n        const loginRes = await loginReq.body.json() as any;\r\n\r\n        if (!loginRes.result) {\r\n            throw new Error(\"Login failed: Unknown data\");\r\n        }\r\n\r\n        if (loginRes.result.ok) {\r\n            this.sessionId = loginRes.sessionId;\r\n            return loginRes;\r\n        }\r\n        else if (loginRes.result.responseCode === \"GW283\") {\r\n            // Again...\r\n            return this.login();\r\n        }\r\n        else {\r\n            const e = new Error(\"Login failed: (\" + loginRes.result.responseCode + \"): \" + loginRes.result.message) as any;\r\n            e.code = loginRes.result.responseCode;\r\n            throw e;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Generates a reference ID required by MB Bank API.\r\n     * The format is \"{username}-{timestamp}\".\r\n     *\r\n     * @private\r\n     * @returns {string} Reference ID for API requests\r\n     */\r\n    private getRefNo() {\r\n        return `${this.username}-${getTimeNow()}`;\r\n    }\r\n\r\n    /**\r\n     * Makes an authenticated request to MB Bank API.\r\n     * Handles session expiration by automatically re-logging in.\r\n     *\r\n     * @private\r\n     * @param {Object} data - Request parameters\r\n     * @param {string} data.path - API endpoint path\r\n     * @param {Object} [data.json] - Request body data\r\n     * @param {Object} [data.headers] - Additional request headers\r\n     * @returns {Promise<any>} API response\r\n     * @throws {Error} If the request fails with error code and message\r\n     */\r\n    private async mbRequest(data: { path: string, json?: object, headers?: object }) : Promise<any> {\r\n        if (!this.sessionId) {\r\n            await this.login();\r\n        }\r\n\r\n        const rId = this.getRefNo();\r\n\r\n        const headers = defaultHeaders as any;\r\n        headers[\"X-Request-Id\"] = rId;\r\n        headers[\"Deviceid\"] = this.deviceId,\r\n        headers[\"Refno\"] = rId;\r\n\r\n        const defaultBody = {\r\n            \"sessionId\": this.sessionId,\r\n            \"refNo\": rId,\r\n            \"deviceIdCommon\": this.deviceId,\r\n        };\r\n        const body = Object.assign(defaultBody, data.json);\r\n\r\n        const httpReq = await this.client.request({\r\n            method: \"POST\",\r\n            path: data.path,\r\n            headers,\r\n            body: JSON.stringify(body),\r\n        });\r\n\r\n        const httpRes = await httpReq.body.json() as any;\r\n\r\n        if (!httpRes || !httpRes.result) {\r\n            return false;\r\n        }\r\n        else if (httpRes.result.ok == true) return httpRes;\r\n        else if (httpRes.result.responseCode === \"GW200\") {\r\n            await this.login();\r\n            return this.mbRequest(data);\r\n        }\r\n        else {\r\n            throw new Error(\"Request failed (\" + httpRes.result.responseCode + \"): \" + httpRes.result.message);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Retrieves account balance information for all accounts.\r\n     *\r\n     * @returns {Promise<BalanceList|undefined>} Account balance data or undefined if request fails\r\n     *\r\n     * @example\r\n     * ```typescript\r\n     * const mb = new MB({\r\n     *   username: '0123456789',\r\n     *   password: 'your_password'\r\n     * });\r\n     *\r\n     * async function getAccountInfo() {\r\n     *   await mb.login();\r\n     *   const balanceInfo = await mb.getBalance();\r\n     *\r\n     *   if (balanceInfo) {\r\n     *     console.log(`Total balance: ${balanceInfo.totalBalance} ${balanceInfo.currencyEquivalent}`);\r\n     *\r\n     *     // Display each account's details\r\n     *     balanceInfo.balances.forEach(account => {\r\n     *       console.log(`Account: ${account.name} (${account.number})`);\r\n     *       console.log(`Balance: ${account.balance} ${account.currency}`);\r\n     *       console.log('---');\r\n     *     });\r\n     *   }\r\n     * }\r\n     *\r\n     * getAccountInfo().catch(console.error);\r\n     * ```\r\n     */\r\n    public async getBalance(): Promise<BalanceList | undefined> {\r\n        const balanceData = await this.mbRequest({ path: \"/api/retail-accountms/accountms/getBalance\" });\r\n\r\n        if (!balanceData) return;\r\n\r\n        const balance: BalanceList = {\r\n            totalBalance: balanceData.totalBalanceEquivalent,\r\n            currencyEquivalent: balanceData.currencyEquivalent,\r\n            balances: [],\r\n        };\r\n\r\n        balanceData.acct_list.forEach((acctInfo: unknown) => {\r\n            const acct = acctInfo as any;\r\n\r\n            const balanceData: BalanceData = {\r\n                number: acct.acctNo,\r\n                name: acct.acctNm,\r\n                currency: acct.ccyCd,\r\n                balance: acct.currentBalance,\r\n            };\r\n\r\n            balance.balances?.push(balanceData);\r\n        });\r\n\r\n        balanceData.internationalAcctList.forEach((acctInfo: unknown) => {\r\n            const acct = acctInfo as any;\r\n\r\n            const balanceData: BalanceData = {\r\n                number: acct.acctNo,\r\n                name: acct.acctNm,\r\n                currency: acct.ccyCd,\r\n                balance: acct.currentBalance,\r\n            };\r\n\r\n            balance.balances?.push(balanceData);\r\n        });\r\n\r\n        return balance;\r\n    }\r\n\r\n    /**\r\n     * Retrieves transaction history for a specific account within a date range.\r\n     *\r\n     * @param {Object} data - Request parameters\r\n     * @param {string} data.accountNumber - MB Bank account number to query\r\n     * @param {string} data.fromDate - Start date in format \"DD/MM/YYYY\" or \"D/M/YYYY\"\r\n     * @param {string} data.toDate - End date in format \"DD/MM/YYYY\" or \"D/M/YYYY\"\r\n     * @returns {Promise<TransactionInfo[]|undefined>} Array of transaction details or undefined if request fails\r\n     * @throws {Error} If date range exceeds 90 days or date format is invalid\r\n     *\r\n     * @example\r\n     * ```typescript\r\n     * const mb = new MB({\r\n     *   username: '0123456789',\r\n     *   password: 'your_password'\r\n     * });\r\n     *\r\n     * async function getLastMonthTransactions() {\r\n     *   await mb.login();\r\n     *\r\n     *   // Get account first\r\n     *   const balanceInfo = await mb.getBalance();\r\n     *   if (!balanceInfo?.balances?.length) {\r\n     *     console.log('No accounts found');\r\n     *     return;\r\n     *   }\r\n     *\r\n     *   const accountNumber = balanceInfo.balances[0].number;\r\n     *\r\n     *   // Get transactions for the last 30 days\r\n     *   const today = new Date();\r\n     *   const lastMonth = new Date();\r\n     *   lastMonth.setDate(today.getDate() - 30);\r\n     *\r\n     *   const fromDate = `${lastMonth.getDate()}/${lastMonth.getMonth() + 1}/${lastMonth.getFullYear()}`;\r\n     *   const toDate = `${today.getDate()}/${today.getMonth() + 1}/${today.getFullYear()}`;\r\n     *\r\n     *   const transactions = await mb.getTransactionsHistory({\r\n     *     accountNumber,\r\n     *     fromDate,\r\n     *     toDate\r\n     *   });\r\n     *\r\n     *   if (transactions) {\r\n     *     console.log(`Found ${transactions.length} transactions`);\r\n     *\r\n     *     transactions.forEach(tx => {\r\n     *       const amount = tx.creditAmount || tx.debitAmount;\r\n     *       const type = tx.creditAmount ? 'CREDIT' : 'DEBIT';\r\n     *\r\n     *       console.log(`${tx.transactionDate} | ${type} | ${amount} ${tx.transactionCurrency}`);\r\n     *       console.log(`Description: ${tx.transactionDesc}`);\r\n     *       if (tx.toAccountName) {\r\n     *         console.log(`To: ${tx.toAccountName} (${tx.toAccountNumber}) at ${tx.toBank}`);\r\n     *       }\r\n     *       console.log('---');\r\n     *     });\r\n     *   }\r\n     * }\r\n     *\r\n     * getLastMonthTransactions().catch(console.error);\r\n     * ```\r\n     */\r\n    public async getTransactionsHistory(data: { accountNumber: string, fromDate: string, toDate: string }): Promise<TransactionInfo[] | undefined> {\r\n        if (moment().day() - moment(data.fromDate, \"D/M/YYYY\").day() > 90 || moment().day() - moment(data.fromDate, \"D/M/YYYY\").day() > 90) throw new Error(\"Date formatting error: Max transaction history must be shorter than 90 days!\");\r\n        if (moment(data.fromDate, \"DD/MM/YYYY\").day() - moment(data.toDate, \"D/M/YYYY\").day() > 90) throw new Error(\"Date formatting error: Max transaction history must be shorter than 90 days!\");\r\n\r\n        const body = {\r\n            \"accountNo\": data.accountNumber,\r\n            \"fromDate\": moment(data.fromDate, \"D/M/YYYY\").format(\"DD/MM/YYYY\"),\r\n            \"toDate\": moment(data.toDate, \"D/M/YYYY\").format(\"DD/MM/YYYY\"),\r\n        };\r\n\r\n        const historyData = await this.mbRequest({ path: \"/api/retail-transactionms/transactionms/get-account-transaction-history\", json: body });\r\n\r\n        if (!historyData || !historyData.transactionHistoryList) return;\r\n\r\n        const transactionHistories: TransactionInfo[] = [];\r\n\r\n        historyData.transactionHistoryList.forEach((transactionRaw: unknown) => {\r\n\r\n            const transaction = transactionRaw as any;\r\n\r\n            const transactionData: TransactionInfo = {\r\n                postDate: transaction.postingDate,\r\n                transactionDate: transaction.transactionDate,\r\n                accountNumber: transaction.accountNo,\r\n                creditAmount: transaction.creditAmount,\r\n                debitAmount: transaction.debitAmount,\r\n                transactionCurrency: transaction.currency,\r\n                transactionDesc: transaction.description,\r\n                balanceAvailable: transaction.availableBalance,\r\n                refNo: transaction.refNo,\r\n                toAccountName: transaction.benAccountName,\r\n                toBank: transaction.bankName,\r\n                toAccountNumber: transaction.benAccountNo,\r\n                type: transaction.transactionType,\r\n            };\r\n\r\n            transactionHistories.push(transactionData);\r\n        });\r\n\r\n        return transactionHistories;\r\n    }\r\n}\r\n","/*\r\n * MIT License\r\n *\r\n * Copyright (c) 2024 CookieGMVN and contributors\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to deal\r\n * in the Software without restriction, including without limitation the rights\r\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n * copies of the Software, and to permit persons to whom the Software is\r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\nimport Jimp from \"jimp\";\r\nimport moment from \"moment\";\r\n\r\n/**\r\n * Gets the current time in a specific format\r\n * @returns {string} The current time in format YYYYMMDDHHmmss + milliseconds (truncated)\r\n */\r\nexport function getTimeNow(): string {\r\n    return moment().format(\"YYYYMMDDHHmmss\" + moment().millisecond().toString().slice(0, -1));\r\n}\r\n\r\n/**\r\n * Generates a device ID for authentication purposes\r\n * @returns {string} A device ID string in the format \"s1rmi184-mbib-0000-0000-\" + timestamp\r\n */\r\nexport function generateDeviceId() {\r\n    return \"s1rmi184-mbib-0000-0000-\" + getTimeNow();\r\n}\r\n\r\n/**\r\n * Default headers for API requests\r\n * @type {Object}\r\n */\r\nexport const defaultHeaders = {\r\n    'Cache-Control': 'max-age=0',\r\n    'Accept': 'application/json, text/plain, */*',\r\n    'Authorization': 'Basic RU1CUkVUQUlMV0VCOlNEMjM0ZGZnMzQlI0BGR0AzNHNmc2RmNDU4NDNm',\r\n    'User-Agent': \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/134.0.0.0 Safari/537.36\",\r\n    \"Origin\": \"https://online.mbbank.com.vn\",\r\n    \"Referer\": \"https://online.mbbank.com.vn/pl/login?returnUrl=%2F\",\r\n    \"Content-Type\": \"application/json; charset=UTF-8\",\r\n    app: \"MB_WEB\",\r\n    \"elastic-apm-traceparent\": \"00-55b950e3fcabc785fa6db4d7deb5ef73-8dbd60b04eda2f34-01\",\r\n    \"Sec-Ch-Ua\": '\"Not.A/Brand\";v=\"8\", \"Chromium\";v=\"134\", \"Google Chrome\";v=\"134\"',\r\n    \"Sec-Ch-Ua-Mobile\": \"?0\",\r\n    \"Sec-Ch-Ua-Platform\": '\"Windows\"',\r\n    \"Sec-Fetch-Dest\": \"empty\",\r\n    \"Sec-Fetch-Mode\": \"cors\",\r\n    \"Sec-Fetch-Site\": \"same-origin\",\r\n};\r\n\r\n/**\r\n * Default configuration for Tesseract OCR\r\n * @type {Object}\r\n */\r\nexport const defaultTesseractConfig = {\r\n    lang: \"eng\",\r\n    oem: 1,\r\n    psm: 12,\r\n};\r\n\r\n/**\r\n * Fingerprint value for authentication\r\n * @type {string}\r\n */\r\nexport const FPR = \"c7a1beebb9400375bb187daa33de9659\";\r\n\r\n/**\r\n * Replaces a target color in an image with a different color\r\n * @param {Object} options - The options object\r\n * @param {Buffer} options.image - The image buffer to process\r\n * @param {string} options.target - The target color in hex format (with or without # prefix)\r\n * @param {string} options.replace - The replacement color in hex format (with or without # prefix)\r\n * @param {number} [options.tolerance=0] - The color matching tolerance (0-100)\r\n * @returns {Promise<Buffer>} A Promise that resolves to the modified image buffer\r\n * @throws {Error} If image processing fails\r\n */\r\nexport async function replaceColor({\r\n    image,\r\n    target,\r\n    replace,\r\n    tolerance = 0,\r\n}: {\r\n    image: Buffer,\r\n    target: string,\r\n    replace: string,\r\n    tolerance?: number\r\n}): Promise<Buffer> {\r\n    try {\r\n        // Load the image from buffer\r\n        const jimpImage = await Jimp.read(image);\r\n\r\n        // Parse hex colors to RGBA values\r\n        // Handle hex colors with or without # prefix\r\n        const targetHex = target.startsWith('#') ? target.substring(1) : target;\r\n        const replaceHex = replace.startsWith('#') ? replace.substring(1) : replace;\r\n\r\n        // Convert hex to RGB integers\r\n        const targetR = parseInt(targetHex.substring(0, 2), 16);\r\n        const targetG = parseInt(targetHex.substring(2, 4), 16);\r\n        const targetB = parseInt(targetHex.substring(4, 6), 16);\r\n\r\n        const replaceR = parseInt(replaceHex.substring(0, 2), 16);\r\n        const replaceG = parseInt(replaceHex.substring(2, 4), 16);\r\n        const replaceB = parseInt(replaceHex.substring(4, 6), 16);\r\n\r\n        // Calculate tolerance threshold (normalize to 0-255 scale for each channel)\r\n        const maxDiff = 255 * Math.min(tolerance / 100, 1);\r\n\r\n        // Process each pixel\r\n        jimpImage.scan(0, 0, jimpImage.getWidth(), jimpImage.getHeight(), function(x, y, idx) {\r\n            // Get current pixel RGB values\r\n            const r = this.bitmap.data[idx + 0];\r\n            const g = this.bitmap.data[idx + 1];\r\n            const b = this.bitmap.data[idx + 2];\r\n            // Alpha is at idx + 3\r\n\r\n            // Calculate color difference using Euclidean distance\r\n            const colorDiff = Math.sqrt(\r\n                Math.pow(r - targetR, 2) +\r\n                Math.pow(g - targetG, 2) +\r\n                Math.pow(b - targetB, 2),\r\n            );\r\n\r\n            // Replace the color if within tolerance\r\n            if (colorDiff <= maxDiff) {\r\n                this.bitmap.data[idx + 0] = replaceR;\r\n                this.bitmap.data[idx + 1] = replaceG;\r\n                this.bitmap.data[idx + 2] = replaceB;\r\n                // Alpha channel is preserved\r\n            }\r\n        });\r\n\r\n        // Return the modified image as a buffer\r\n        return await jimpImage.getBufferAsync(Jimp.MIME_PNG);\r\n    } catch (error) {\r\n        console.error('Error in replaceColor:', error);\r\n        throw new Error(`Failed to process image: ${(error as Error).message}`);\r\n    }\r\n}\r\n\r\n/**\r\n * Cuts a border of specified width from all sides of an image\r\n * @param {Object} options - The options object\r\n * @param {Buffer} options.image - The image buffer to process\r\n * @param {number} [options.borderWidth=5] - The width of the border to remove in pixels\r\n * @returns {Promise<Buffer>} A Promise that resolves to the modified image buffer\r\n * @throws {Error} If the image is too small or processing fails\r\n */\r\nexport async function cutBorder({\r\n    image,\r\n    borderWidth = 5,\r\n}: {\r\n    image: Buffer,\r\n    borderWidth?: number\r\n}): Promise<Buffer> {\r\n    try {\r\n        // Load the image from buffer\r\n        const jimpImage = await Jimp.read(image);\r\n\r\n        // Get the original dimensions\r\n        const originalWidth = jimpImage.getWidth();\r\n        const originalHeight = jimpImage.getHeight();\r\n\r\n        // Check if image is large enough to cut the border\r\n        if (originalWidth <= 2 * borderWidth || originalHeight <= 2 * borderWidth) {\r\n            throw new Error('Image is too small to cut the specified border width');\r\n        }\r\n\r\n        // Calculate new dimensions\r\n        const newWidth = originalWidth - (2 * borderWidth);\r\n        const newHeight = originalHeight - (2 * borderWidth);\r\n\r\n        // Crop the image (removing the border from all sides)\r\n        const croppedImage = jimpImage.crop(\r\n            borderWidth,\r\n            borderWidth,\r\n            newWidth,\r\n            newHeight,\r\n        );\r\n\r\n        // Return the modified image as a buffer\r\n        return await croppedImage.getBufferAsync(Jimp.MIME_PNG);\r\n    } catch (error) {\r\n        console.error('Error in cutBorder:', error);\r\n        throw new Error(`Failed to process image: ${(error as Error).message}`);\r\n    }\r\n}","/*\r\n * MIT License\r\n *\r\n * Copyright (c) 2024 CookieGMVN and contributors\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to deal\r\n * in the Software without restriction, including without limitation the rights\r\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n * copies of the Software, and to permit persons to whom the Software is\r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\n/* eslint-disable */\r\n// @ts-nocheck\r\n\r\nconst window = {\r\n    globalThis,\r\n    document: {\r\n        welovemb: true\r\n    }\r\n};\r\n\r\nglobalThis.window = window;\r\nglobalThis.location = new URL(\"https://online.mbbank.com.vn/pl/login\");\r\n\r\nconst processAsync = (param1, param2, generatorFunction) =>\r\n    new Promise((resolve, reject) => {\r\n        var handleResult = (result) => {\r\n            try {\r\n                processStep(generatorFunction.next(result));\r\n            } catch (error) {\r\n                reject(error);\r\n            }\r\n        },\r\n            handleError = (error) => {\r\n                try {\r\n                    processStep(generatorFunction.throw(error));\r\n                } catch (err) {\r\n                    reject(err);\r\n                }\r\n            },\r\n            processStep = (step) =>\r\n                step.done\r\n                    ? resolve(step.value)\r\n                    : Promise.resolve(step.value).then(handleResult, handleError);\r\n        processStep(\r\n            (generatorFunction = generatorFunction.apply(param1, param2)).next(),\r\n        );\r\n    });\r\n\r\n(() => {\r\n    const ErrENOSYS = () => {\r\n        const err = new Error(\"not implemented\");\r\n        err.code = \"ENOSYS\";\r\n        return err;\r\n    };\r\n    if (!globalThis.fs) {\r\n        let data = \"\";\r\n        globalThis.fs = {\r\n            constants: {\r\n                O_WRONLY: -1,\r\n                O_RDWR: -1,\r\n                O_CREAT: -1,\r\n                O_TRUNC: -1,\r\n                O_APPEND: -1,\r\n                O_EXCL: -1,\r\n            },\r\n            writeSync(fd, buffer) {\r\n                data += TextDecoderUnicode.decode(buffer);\r\n                const indexEOL = data.lastIndexOf(\"\\n\");\r\n                if (indexEOL != -1) {\r\n                    console.log(data.substring(0x0, indexEOL));\r\n                    data = data.substring(indexEOL + 0x1);\r\n                }\r\n                return buffer.length;\r\n            },\r\n            write(fd, buffer, offset, length, position, callback) {\r\n                if (offset === 0 && length === buffer.length && position === null) {\r\n                    callback(null, this.writeSync(fd, buffer));\r\n                } else {\r\n                    callback(ErrENOSYS());\r\n                }\r\n            },\r\n            fsync(fd, callback) {\r\n                callback(null);\r\n            },\r\n        };\r\n    }\r\n    if (!globalThis.process) {\r\n        globalThis.process = {\r\n            getuid: () => -1,\r\n            getgid: () => -1,\r\n            geteuid: () => -1,\r\n            getegid: () => -1,\r\n            pid: -1,\r\n            ppid: -1,\r\n        };\r\n    }\r\n    if (!globalThis.crypto) {\r\n        throw new Error(\r\n            \"globalThis.crypto is not available, polyfill required (crypto.getRandomValues only)\",\r\n        );\r\n    }\r\n    if (!globalThis.performance) {\r\n        throw new Error(\r\n            \"globalThis.performance is not available, polyfill required (performance.now only)\",\r\n        );\r\n    }\r\n    if (!globalThis.TextEncoder) {\r\n        throw new Error(\r\n            \"globalThis.TextEncoder is not available, polyfill required\",\r\n        );\r\n    }\r\n    if (!globalThis.TextDecoder) {\r\n        throw new Error(\r\n            \"globalThis.TextDecoder is not available, polyfill required\",\r\n        );\r\n    }\r\n\r\n    const TextEncoderUnicode = new TextEncoder(\"utf-8\");\r\n    const TextDecoderUnicode = new TextDecoder(\"utf-8\");\r\n\r\n    globalThis.Go = class {\r\n        constructor() {\r\n            this.argv = [\"js\"];\r\n            this.env = {};\r\n            this.exit = (exitCode) => {\r\n                if (exitCode !== 0) {\r\n                    console.warn(\"exit code:\", exitCode);\r\n                }\r\n            };\r\n            this._exitPromise = new Promise((resolve) => {\r\n                this._resolveExitPromise = resolve;\r\n            });\r\n            this._pendingEvent = null;\r\n            this._scheduledTimeouts = new Map();\r\n            this._nextCallbackTimeoutID = 1;\r\n\r\n            const setMemoryValue = (address, value) => {\r\n                this.mem.setUint32(address + 0x0, value, true);\r\n                this.mem.setUint32(\r\n                    address + 0x4,\r\n                    Math.floor(value / 0x100000000),\r\n                    true,\r\n                );\r\n            };\r\n\r\n            const getValueFromMemory = (address) => {\r\n                const floatValue = this.mem.getFloat64(address, true);\r\n                if (floatValue === 0) {\r\n                    return;\r\n                }\r\n                if (!isNaN(floatValue)) {\r\n                    return floatValue;\r\n                }\r\n                const intValue = this.mem.getUint32(address, true);\r\n                return this._values[intValue];\r\n            };\r\n\r\n            const setValueInMemory = (address, value) => {\r\n                if (typeof value === \"number\" && value !== 0) {\r\n                    if (isNaN(value)) {\r\n                        this.mem.setUint32(address + 0x4, 0x7ff80000, true);\r\n                        this.mem.setUint32(address, 0x0, true);\r\n                    } else {\r\n                        this.mem.setFloat64(address, value, true);\r\n                    }\r\n                    return;\r\n                }\r\n\r\n                if (value === undefined) {\r\n                    this.mem.setFloat64(address, 0x0, true);\r\n                    return;\r\n                }\r\n\r\n                let id = this._ids.get(value);\r\n                if (id === undefined) {\r\n                    id = this._idPool.pop();\r\n                    if (id === undefined) {\r\n                        id = this._values.length;\r\n                    }\r\n                    this._values[id] = value;\r\n                    this._goRefCounts[id] = 0;\r\n                    this._ids.set(value, id);\r\n                }\r\n                this._goRefCounts[id]++;\r\n\r\n                let typeFlag = 0;\r\n                switch (typeof value) {\r\n                    case \"object\":\r\n                        if (value !== null) {\r\n                            typeFlag = 1;\r\n                        }\r\n                        break;\r\n                    case \"string\":\r\n                        typeFlag = 2;\r\n                        break;\r\n                    case \"symbol\":\r\n                        typeFlag = 3;\r\n                        break;\r\n                    case \"function\":\r\n                        typeFlag = 4;\r\n                }\r\n\r\n                this.mem.setUint32(address + 0x4, 0x7ff80000 | typeFlag, true);\r\n                this.mem.setUint32(address, id, true);\r\n            };\r\n\r\n            const getByteArrayFromMemory = (address) => {\r\n                const startAddress =\r\n                    this.mem.getUint32(address + 0x0, true) +\r\n                    0x100000000 * this.mem.getInt32(address + 0x4, true);\r\n\r\n                const length =\r\n                    this.mem.getUint32(address + 0x8, true) +\r\n                    0x100000000 * this.mem.getInt32(address + 0xc, true);\r\n\r\n                return new Uint8Array(\r\n                    this._inst.exports.mem.buffer,\r\n                    startAddress,\r\n                    length,\r\n                );\r\n            };\r\n\r\n            const getArrayFromMemory = (address) => {\r\n                const startAddress =\r\n                    this.mem.getUint32(address + 0x0, true) +\r\n                    0x100000000 * this.mem.getInt32(address + 0x4, true);\r\n\r\n                const length =\r\n                    this.mem.getUint32(address + 0x8, true) +\r\n                    0x100000000 * this.mem.getInt32(address + 0xc, true);\r\n\r\n                const array = new Array(length);\r\n                for (let i = 0; i < length; i++) {\r\n                    array[i] = getValueFromMemory(startAddress + 0x8 * i);\r\n                }\r\n\r\n                return array;\r\n            };\r\n\r\n            const getStringFromMemory = (address) => {\r\n                const startAddress =\r\n                    this.mem.getUint32(address + 0x0, true) +\r\n                    0x100000000 * this.mem.getInt32(address + 0x4, true);\r\n\r\n                const length =\r\n                    this.mem.getUint32(address + 0x8, true) +\r\n                    0x100000000 * this.mem.getInt32(address + 0xc, true);\r\n\r\n                return TextDecoderUnicode.decode(\r\n                    new DataView(this._inst.exports.mem.buffer, startAddress, length),\r\n                );\r\n            };\r\n\r\n            const timeDifference = Date.now() - performance.now();\r\n\r\n            this.importObject = {\r\n                _gotest: {\r\n                    add: (a, b) => a + b,\r\n                },\r\n                gojs: {\r\n                    \"runtime.wasmExit\": (input) => {\r\n                        const exitCode = this.mem.getInt32(0x8 + (input >>>= 0x0), true);\r\n                        this.exited = true;\r\n                        delete this._inst;\r\n                        delete this._values;\r\n                        delete this._goRefCounts;\r\n                        delete this._ids;\r\n                        delete this._idPool;\r\n                        this.exit(exitCode);\r\n                    },\r\n                    \"runtime.wasmWrite\": (address) => {\r\n                        const fileDescriptor =\r\n                            this.mem.getUint32(0x8 + (address >>>= 0x0) + 0x0, true) +\r\n                            0x100000000 *\r\n                            this.mem.getInt32(0x8 + (address >>>= 0x0) + 0x4, true);\r\n\r\n                        const dataAddress =\r\n                            this.mem.getUint32(address + 0x10 + 0x0, true) +\r\n                            0x100000000 * this.mem.getInt32(address + 0x10 + 0x4, true);\r\n\r\n                        const dataLength = this.mem.getInt32(address + 0x18, true);\r\n\r\n                        fs.writeSync(\r\n                            fileDescriptor,\r\n                            new Uint8Array(\r\n                                this._inst.exports.mem.buffer,\r\n                                dataAddress,\r\n                                dataLength,\r\n                            ),\r\n                        );\r\n                    },\r\n                    \"runtime.resetMemoryDataView\": (_0x1fc0dd) => {\r\n                        this.mem = new DataView(this._inst.exports.mem.buffer);\r\n                    },\r\n                    \"runtime.nanotime1\": (_0x5843c4) => {\r\n                        setMemoryValue(\r\n                            0x8 + (_0x5843c4 >>>= 0x0),\r\n                            0xf4240 * (timeDifference + performance.now()),\r\n                        );\r\n                    },\r\n                    \"runtime.walltime\": (_0x431dd5) => {\r\n                        _0x431dd5 >>>= 0x0;\r\n                        const _0x2d1628 = new Date().getTime();\r\n                        setMemoryValue(_0x431dd5 + 0x8, _0x2d1628 / 0x3e8);\r\n                        this.mem.setInt32(\r\n                            _0x431dd5 + 0x10,\r\n                            (_0x2d1628 % 0x3e8) * 0xf4240,\r\n                            true,\r\n                        );\r\n                    },\r\n                    \"runtime.scheduleTimeoutEvent\": (_0x40be90) => {\r\n                        _0x40be90 >>>= 0x0;\r\n                        const _0x4d23db = this._nextCallbackTimeoutID;\r\n                        this._nextCallbackTimeoutID++;\r\n                        this._scheduledTimeouts.set(\r\n                            _0x4d23db,\r\n                            setTimeout(() => {\r\n                                for (this._resume(); this._scheduledTimeouts.has(_0x4d23db);) {\r\n                                    console.warn(\"scheduleTimeoutEvent: missed timeout event\");\r\n                                    this._resume();\r\n                                }\r\n                            }, this.mem.getUint32(_0x40be90 + 0x8 + 0x0, true) + 0x100000000 * this.mem.getInt32(_0x40be90 + 0x8 + 0x4, true)),\r\n                        );\r\n                        this.mem.setInt32(_0x40be90 + 0x10, _0x4d23db, true);\r\n                    },\r\n                    \"runtime.clearTimeoutEvent\": (_0x4d392b) => {\r\n                        const _0x157834 = this.mem.getInt32(\r\n                            0x8 + (_0x4d392b >>>= 0x0),\r\n                            true,\r\n                        );\r\n                        clearTimeout(this._scheduledTimeouts.get(_0x157834));\r\n                        this._scheduledTimeouts[\"delete\"](_0x157834);\r\n                    },\r\n                    \"runtime.getRandomData\": (_0xfc09b6) => {\r\n                        crypto.getRandomValues(\r\n                            getByteArrayFromMemory(0x8 + (_0xfc09b6 >>>= 0x0)),\r\n                        );\r\n                    },\r\n                    \"syscall/js.finalizeRef\": (_0x5edca4) => {\r\n                        const _0x57d4fc = this.mem.getUint32(\r\n                            0x8 + (_0x5edca4 >>>= 0x0),\r\n                            true,\r\n                        );\r\n                        this._goRefCounts[_0x57d4fc]--;\r\n                        if (this._goRefCounts[_0x57d4fc] === 0x0) {\r\n                            const _0x372c88 = this._values[_0x57d4fc];\r\n                            this._values[_0x57d4fc] = null;\r\n                            this._ids[\"delete\"](_0x372c88);\r\n                            this._idPool.push(_0x57d4fc);\r\n                        }\r\n                    },\r\n                    \"syscall/js.stringVal\": (_0x11c7ea) => {\r\n                        setValueInMemory(\r\n                            0x18 + (_0x11c7ea >>>= 0x0),\r\n                            getStringFromMemory(_0x11c7ea + 0x8),\r\n                        );\r\n                    },\r\n                    \"syscall/js.valueGet\": (_0x3c119c) => {\r\n                        _0x3c119c >>>= 0x0;\r\n                        const _0x57d3f0 = Reflect.get(\r\n                            getValueFromMemory(_0x3c119c + 0x8),\r\n                            getStringFromMemory(_0x3c119c + 0x10),\r\n                        );\r\n                        _0x3c119c = this._inst.exports.getsp() >>> 0x0;\r\n                        setValueInMemory(_0x3c119c + 0x20, _0x57d3f0);\r\n                    },\r\n                    \"syscall/js.valueSet\": (_0x2df90d) => {\r\n                        _0x2df90d >>>= 0x0;\r\n                        Reflect.set(\r\n                            getValueFromMemory(_0x2df90d + 0x8),\r\n                            getStringFromMemory(_0x2df90d + 0x10),\r\n                            getValueFromMemory(_0x2df90d + 0x20),\r\n                        );\r\n                    },\r\n                    \"syscall/js.valueDelete\": (_0x5c6169) => {\r\n                        _0x5c6169 >>>= 0x0;\r\n                        Reflect.deleteProperty(\r\n                            getValueFromMemory(_0x5c6169 + 0x8),\r\n                            getStringFromMemory(_0x5c6169 + 0x10),\r\n                        );\r\n                    },\r\n                    \"syscall/js.valueIndex\": (_0xd5cf7e) => {\r\n                        setValueInMemory(\r\n                            0x18 + (_0xd5cf7e >>>= 0x0),\r\n                            Reflect.get(\r\n                                getValueFromMemory(_0xd5cf7e + 0x8),\r\n                                this.mem.getUint32(_0xd5cf7e + 0x10 + 0x0, true) +\r\n                                0x100000000 * this.mem.getInt32(_0xd5cf7e + 0x10 + 0x4, true),\r\n                            ),\r\n                        );\r\n                    },\r\n                    \"syscall/js.valueSetIndex\": (_0x1b938f) => {\r\n                        _0x1b938f >>>= 0x0;\r\n                        Reflect.set(\r\n                            getValueFromMemory(_0x1b938f + 0x8),\r\n                            this.mem.getUint32(_0x1b938f + 0x10 + 0x0, true) +\r\n                            0x100000000 * this.mem.getInt32(_0x1b938f + 0x10 + 0x4, true),\r\n                            getValueFromMemory(_0x1b938f + 0x18),\r\n                        );\r\n                    },\r\n                    \"syscall/js.valueCall\": (_0x38baf6) => {\r\n                        _0x38baf6 >>>= 0x0;\r\n                        try {\r\n                            const _0xb55714 = getValueFromMemory(_0x38baf6 + 0x8);\r\n                            const _0x4b45ac = Reflect.get(\r\n                                _0xb55714,\r\n                                getStringFromMemory(_0x38baf6 + 0x10),\r\n                            );\r\n                            const _0x929c90 = getArrayFromMemory(_0x38baf6 + 0x20);\r\n                            const _0x331ca0 = Reflect.apply(_0x4b45ac, _0xb55714, _0x929c90);\r\n                            _0x38baf6 = this._inst.exports.getsp() >>> 0x0;\r\n                            setValueInMemory(_0x38baf6 + 0x38, _0x331ca0);\r\n                            this.mem.setUint8(_0x38baf6 + 0x40, 0x1);\r\n                        } catch (_0x3b2cd8) {\r\n                            _0x38baf6 = this._inst.exports.getsp() >>> 0x0;\r\n                            setValueInMemory(_0x38baf6 + 0x38, _0x3b2cd8);\r\n                            this.mem.setUint8(_0x38baf6 + 0x40, 0x0);\r\n                        }\r\n                    },\r\n                    \"syscall/js.valueInvoke\": (_0x19f35b) => {\r\n                        _0x19f35b >>>= 0x0;\r\n                        try {\r\n                            const _0xdd2a3 = getValueFromMemory(_0x19f35b + 0x8);\r\n                            const _0x330c8f = getArrayFromMemory(_0x19f35b + 0x10);\r\n                            const _0x49e23c = Reflect.apply(_0xdd2a3, undefined, _0x330c8f);\r\n                            _0x19f35b = this._inst.exports.getsp() >>> 0x0;\r\n                            setValueInMemory(_0x19f35b + 0x28, _0x49e23c);\r\n                            this.mem.setUint8(_0x19f35b + 0x30, 0x1);\r\n                        } catch (_0x5bd1fc) {\r\n                            _0x19f35b = this._inst.exports.getsp() >>> 0x0;\r\n                            setValueInMemory(_0x19f35b + 0x28, _0x5bd1fc);\r\n                            this.mem.setUint8(_0x19f35b + 0x30, 0x0);\r\n                        }\r\n                    },\r\n                    \"syscall/js.valueNew\": (_0x275c5e) => {\r\n                        _0x275c5e >>>= 0x0;\r\n                        try {\r\n                            const _0x2a547b = getValueFromMemory(_0x275c5e + 0x8);\r\n                            const _0x3fcde3 = getArrayFromMemory(_0x275c5e + 0x10);\r\n                            const _0x94eb67 = Reflect.construct(_0x2a547b, _0x3fcde3);\r\n                            _0x275c5e = this._inst.exports.getsp() >>> 0x0;\r\n                            setValueInMemory(_0x275c5e + 0x28, _0x94eb67);\r\n                            this.mem.setUint8(_0x275c5e + 0x30, 0x1);\r\n                        } catch (_0x5b3614) {\r\n                            _0x275c5e = this._inst.exports.getsp() >>> 0x0;\r\n                            setValueInMemory(_0x275c5e + 0x28, _0x5b3614);\r\n                            this.mem.setUint8(_0x275c5e + 0x30, 0x0);\r\n                        }\r\n                    },\r\n                    \"syscall/js.valueLength\": (_0x2cc204) => {\r\n                        setMemoryValue(\r\n                            0x10 + (_0x2cc204 >>>= 0x0),\r\n                            parseInt(getValueFromMemory(_0x2cc204 + 0x8).length),\r\n                        );\r\n                    },\r\n                    \"syscall/js.valuePrepareString\": (_0x57c513) => {\r\n                        _0x57c513 >>>= 0x0;\r\n                        const _0xe5ad3d = TextEncoderUnicode.encode(\r\n                            String(getValueFromMemory(_0x57c513 + 0x8)),\r\n                        );\r\n                        setValueInMemory(_0x57c513 + 0x10, _0xe5ad3d);\r\n                        setMemoryValue(_0x57c513 + 0x18, _0xe5ad3d.length);\r\n                    },\r\n                    \"syscall/js.valueLoadString\": (_0xd20694) => {\r\n                        const _0x1bcf7e = getValueFromMemory(0x8 + (_0xd20694 >>>= 0x0));\r\n                        getByteArrayFromMemory(_0xd20694 + 0x10).set(_0x1bcf7e);\r\n                    },\r\n                    \"syscall/js.valueInstanceOf\": (_0x515e20) => {\r\n                        this.mem.setUint8(\r\n                            0x18 + (_0x515e20 >>>= 0x0),\r\n                            getValueFromMemory(_0x515e20 + 0x8) instanceof\r\n                                getValueFromMemory(_0x515e20 + 0x10)\r\n                                ? 0x1\r\n                                : 0x0,\r\n                        );\r\n                    },\r\n                    \"syscall/js.copyBytesToGo\": (_0x3b040d) => {\r\n                        const _0xcf50d7 = getByteArrayFromMemory(\r\n                            0x8 + (_0x3b040d >>>= 0x0),\r\n                        );\r\n                        const _0x502788 = getValueFromMemory(_0x3b040d + 0x20);\r\n                        if (\r\n                            !(\r\n                                _0x502788 instanceof Uint8Array ||\r\n                                _0x502788 instanceof Uint8ClampedArray\r\n                            )\r\n                        ) {\r\n                            return void this.mem.setUint8(_0x3b040d + 0x30, 0x0);\r\n                        }\r\n                        const _0x347884 = _0x502788.subarray(0x0, _0xcf50d7.length);\r\n                        _0xcf50d7.set(_0x347884);\r\n                        setMemoryValue(_0x3b040d + 0x28, _0x347884.length);\r\n                        this.mem.setUint8(_0x3b040d + 0x30, 0x1);\r\n                    },\r\n                    \"syscall/js.copyBytesToJS\": (_0x2c7dbd) => {\r\n                        const _0x3e840b = getValueFromMemory(0x8 + (_0x2c7dbd >>>= 0x0));\r\n                        const _0x47be1d = getByteArrayFromMemory(_0x2c7dbd + 0x10);\r\n                        if (\r\n                            !(\r\n                                _0x3e840b instanceof Uint8Array ||\r\n                                _0x3e840b instanceof Uint8ClampedArray\r\n                            )\r\n                        ) {\r\n                            return void this.mem.setUint8(_0x2c7dbd + 0x30, 0x0);\r\n                        }\r\n                        const _0x2d9d42 = _0x47be1d.subarray(0x0, _0x3e840b.length);\r\n                        _0x3e840b.set(_0x2d9d42);\r\n                        setMemoryValue(_0x2c7dbd + 0x28, _0x2d9d42.length);\r\n                        this.mem.setUint8(_0x2c7dbd + 0x30, 0x1);\r\n                    },\r\n                    debug: (_0x5560e3) => {\r\n                        console.log(_0x5560e3);\r\n                    },\r\n                },\r\n            };\r\n        }\r\n        run(_0x3a3ab2) {\r\n            return processAsync(this, null, function* () {\r\n                if (!(_0x3a3ab2 instanceof WebAssembly.Instance)) {\r\n                    throw new Error(\"Go.run: WebAssembly.Instance expected\");\r\n                }\r\n                this._inst = _0x3a3ab2;\r\n                this.mem = new DataView(this._inst.exports.mem.buffer);\r\n                this._values = [NaN, 0x0, null, true, false, globalThis, this];\r\n                this._goRefCounts = new Array(this._values.length).fill(Infinity);\r\n                this._ids = new Map([\r\n                    [0x0, 0x1],\r\n                    [null, 0x2],\r\n                    [true, 0x3],\r\n                    [false, 0x4],\r\n                    [globalThis, 0x5],\r\n                    [this, 0x6],\r\n                ]);\r\n                this._idPool = [];\r\n                this.exited = false;\r\n                let _0x5c27d6 = 0x1000;\r\n                const _0x17ab00 = (_0x592ac2) => {\r\n                    const _0x42047b = _0x5c27d6;\r\n                    const _0x169394 = TextEncoderUnicode.encode(_0x592ac2 + \"\\0\");\r\n                    new Uint8Array(this.mem.buffer, _0x5c27d6, _0x169394.length).set(\r\n                        _0x169394,\r\n                    );\r\n                    _0x5c27d6 += _0x169394.length;\r\n                    if (_0x5c27d6 % 0x8 != 0x0) {\r\n                        _0x5c27d6 += 0x8 - (_0x5c27d6 % 0x8);\r\n                    }\r\n                    return _0x42047b;\r\n                };\r\n                const _0x33ce5b = this.argv.length;\r\n                const _0x1d93e4 = [];\r\n                this.argv.forEach((_0x2b450c) => {\r\n                    _0x1d93e4.push(_0x17ab00(_0x2b450c));\r\n                });\r\n                _0x1d93e4.push(0x0);\r\n                Object.keys(this.env)\r\n                    .sort()\r\n                    .forEach((_0x5793a5) => {\r\n                        _0x1d93e4.push(_0x17ab00(_0x5793a5 + \"=\" + this.env[_0x5793a5]));\r\n                    });\r\n                _0x1d93e4.push(0x0);\r\n                const _0x1563af = _0x5c27d6;\r\n                _0x1d93e4.forEach((_0x2954fa) => {\r\n                    this.mem.setUint32(_0x5c27d6, _0x2954fa, true);\r\n                    this.mem.setUint32(_0x5c27d6 + 0x4, 0x0, true);\r\n                    _0x5c27d6 += 0x8;\r\n                });\r\n                if (_0x5c27d6 >= 0x3000) {\r\n                    throw new Error(\r\n                        \"total length of command line and environment variables exceeds limit\",\r\n                    );\r\n                }\r\n                this._inst.exports.run(_0x33ce5b, _0x1563af);\r\n                if (this.exited) {\r\n                    this._resolveExitPromise();\r\n                }\r\n                yield this._exitPromise;\r\n            });\r\n        }\r\n        _resume() {\r\n            if (this.exited) {\r\n                throw new Error(\"Go program has already exited\");\r\n            }\r\n            this._inst.exports.resume();\r\n            if (this.exited) {\r\n                this._resolveExitPromise();\r\n            }\r\n        }\r\n        _makeFuncWrapper(id) {\r\n            const this_ = this;\r\n            return function() {\r\n                const event = {\r\n                    id,\r\n                    this: this,\r\n                    args: arguments,\r\n                };\r\n                this_._pendingEvent = event;\r\n                this_._resume();\r\n                return event.result;\r\n            };\r\n        }\r\n    };\r\n})();\r\n\r\nexport default function(wasmBytes: Buffer, requestData: any, args1: string): Promise<string> {\r\n    return processAsync(this, null, function* () {\r\n        const go = new Go();\r\n        const instance = (yield WebAssembly.instantiate(wasmBytes, go.importObject))\r\n            .instance;\r\n        go.run(instance);\r\n        return globalThis.bder(JSON.stringify(requestData), args1);\r\n    });\r\n}","/*\r\n * MIT License\r\n *\r\n * Copyright (c) 2025 CookieGMVN and contributors\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to deal\r\n * in the Software without restriction, including without limitation the rights\r\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n * copies of the Software, and to permit persons to whom the Software is\r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\nimport { createWriteStream, existsSync } from 'fs';\r\nimport * as ort from 'onnxruntime-node';\r\nimport * as path from 'path';\r\nimport sharp from 'sharp';\r\nimport { request } from 'undici';\r\n\r\nconst dirPath = path.dirname(require.main ? require.main.filename : __filename);\r\n\r\n/**\r\n * OCR model for recognizing characters in images\r\n * @class\r\n */\r\nexport default class OCRModel {\r\n    /**\r\n     * Character set for recognition\r\n     * @private\r\n     * @type {string[]}\r\n     */\r\n    private chars: string[];\r\n\r\n    /**\r\n     * Path to the ONNX model file\r\n     * @private\r\n     * @type {string}\r\n     */\r\n    private modelPath: string;\r\n\r\n    /**\r\n     * ONNX inference session\r\n     * @private\r\n     * @type {ort.InferenceSession}\r\n     */\r\n    private session!: ort.InferenceSession;\r\n\r\n    /**\r\n     * Creates a new OCR model\r\n     * @param {string|null} modelPath - Optional custom path to the ONNX model file\r\n     */\r\n    public constructor(modelPath: string | null = null) {\r\n        // Create and sort the characters array (digits + letters)\r\n        this.chars = [];\r\n        // Add digits (0-9)\r\n        for (let i = 0; i < 10; i++) {\r\n            this.chars.push(String(i));\r\n        }\r\n        // Add lowercase and uppercase letters (a-z, A-Z)\r\n        for (let i = 97; i <= 122; i++) {\r\n            this.chars.push(String.fromCharCode(i));\r\n        }\r\n        for (let i = 65; i <= 90; i++) {\r\n            this.chars.push(String.fromCharCode(i));\r\n        }\r\n        this.chars.sort();\r\n\r\n        // Set the model path\r\n        this.modelPath = modelPath || path.join(dirPath, '/../model.onnx');\r\n    }\r\n\r\n    /**\r\n     * Loads the ONNX model for inference\r\n     * @returns {Promise<void>} A promise that resolves when the model is loaded\r\n     */\r\n    public async loadModel(): Promise<void> {\r\n        if (!existsSync(this.modelPath)) await this.downloadOnnxModel();\r\n        this.session = await ort.InferenceSession.create(this.modelPath);\r\n    }\r\n\r\n    /**\r\n     * Predicts text from an image\r\n     * @param {Buffer} imageBuffer - The image buffer to process\r\n     * @returns {Promise<string>} A promise that resolves to the recognized text\r\n     */\r\n    public async predict(imageBuffer: Buffer): Promise<string> {\r\n        // Convert image to grayscale and resize\r\n        const processedImage = await sharp(imageBuffer)\r\n            .grayscale()\r\n            .resize(160, 50)\r\n            .raw()\r\n            .toBuffer();\r\n\r\n        // Convert to float32 array and normalize to 0-1\r\n        const imageArray = new Float32Array(processedImage.length);\r\n        for (let i = 0; i < processedImage.length; i++) {\r\n            imageArray[i] = processedImage[i] / 255.0;\r\n        }\r\n\r\n        // Reshape to match the expected input shape [1, 1, 50, 160]\r\n        const tensor = new ort.Tensor('float32', imageArray, [1, 1, 50, 160]);\r\n\r\n        // Get input name\r\n        const inputName = this.session.inputNames[0];\r\n        const feeds: Record<string, ort.Tensor> = {};\r\n        feeds[inputName] = tensor;\r\n\r\n        // Run inference\r\n        const results = await this.session.run(feeds);\r\n        const outputData = Object.values(results)[0].data as Float32Array;\r\n        const outputShape = Object.values(results)[0].dims as number[];\r\n\r\n        // Process predictions\r\n        const pred = this.reshapeTensor(outputData, outputShape);\r\n        const predLabels = this.argmax(pred, 2);\r\n\r\n        // Convert label indices to characters\r\n        let predText = '';\r\n        for (const label of predLabels[0]) {\r\n            if (label >= 0 && label < this.chars.length) {\r\n                predText += this.chars[label];\r\n            }\r\n        }\r\n\r\n        return predText;\r\n    }\r\n\r\n    /**\r\n     * Downloads the ONNX model from GitHub\r\n     * @private\r\n     * @returns {Promise<void>} A promise that resolves when the model is downloaded\r\n     * @throws {Error} If the download fails\r\n     */\r\n    private async downloadOnnxModel(): Promise<void> {\r\n        try {\r\n            // Make the HTTP request\r\n            const model = await request(\"https://github.com/thedtvn/mbbank-capcha-ocr/raw/refs/heads/master/mb_capcha_ocr/model.onnx\", {\r\n                maxRedirections: 10,\r\n                headers: {\r\n                    'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36',\r\n                },\r\n            });\r\n\r\n            // Create a write stream\r\n            const fileStream = createWriteStream(this.modelPath);\r\n\r\n            // Pipe the response body to the file\r\n            await new Promise<void>((resolve, reject) => {\r\n                model.body.pipe(fileStream);\r\n\r\n                model.body.on('error', (err) => {\r\n                    reject(err);\r\n                });\r\n\r\n                fileStream.on('finish', () => {\r\n                    resolve();\r\n                });\r\n\r\n                fileStream.on('error', (err: Error) => {\r\n                    reject(err);\r\n                });\r\n            });\r\n        } catch (error) {\r\n            console.error('Error downloading model:', error);\r\n            throw error;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Reshapes a flat tensor into a 3D array\r\n     * @private\r\n     * @param {Float32Array} data - The flat tensor data\r\n     * @param {number[]} shape - The target shape [batchSize, seqLength, numClasses]\r\n     * @returns {number[][][]} Reshaped 3D array\r\n     */\r\n    private reshapeTensor(data: Float32Array, shape: number[]): number[][][] {\r\n        const result: number[][][] = [];\r\n        const [batchSize, seqLength, numClasses] = shape;\r\n\r\n        for (let b = 0; b < batchSize; b++) {\r\n            const batchResult: number[][] = [];\r\n            for (let s = 0; s < seqLength; s++) {\r\n                const classProbs: number[] = [];\r\n                for (let c = 0; c < numClasses; c++) {\r\n                    const idx = b * seqLength * numClasses + s * numClasses + c;\r\n                    classProbs.push(data[idx]);\r\n                }\r\n                batchResult.push(classProbs);\r\n            }\r\n            result.push(batchResult);\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * Computes argmax along a specified axis\r\n     * @private\r\n     * @param {number[][][]} tensor - The input tensor\r\n     * @param {number} axis - The axis along which to compute argmax (only 2 is supported)\r\n     * @returns {number[][]} The indices of maximum values\r\n     */\r\n    private argmax(tensor: number[][][], axis: number): number[][] {\r\n        const result: number[][] = [];\r\n\r\n        if (axis === 2) {\r\n            for (let b = 0; b < tensor.length; b++) {\r\n                const batchResult: number[] = [];\r\n                for (let s = 0; s < tensor[b].length; s++) {\r\n                    let maxIdx = 0;\r\n                    let maxVal = tensor[b][s][0];\r\n\r\n                    for (let c = 1; c < tensor[b][s].length; c++) {\r\n                        if (tensor[b][s][c] > maxVal) {\r\n                            maxVal = tensor[b][s][c];\r\n                            maxIdx = c;\r\n                        }\r\n                    }\r\n\r\n                    batchResult.push(maxIdx);\r\n                }\r\n                result.push(batchResult);\r\n            }\r\n        }\r\n\r\n        return result;\r\n    }\r\n}","/*\r\n * MIT License\r\n *\r\n * Copyright (c) 2025 CookieGMVN and contributors\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to deal\r\n * in the Software without restriction, including without limitation the rights\r\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n * copies of the Software, and to permit persons to whom the Software is\r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\nimport { recognize } from \"node-tesseract-ocr\";\r\n\r\nimport { cutBorder, defaultTesseractConfig, replaceColor } from \"./Global\";\r\n\r\n/**\r\n * Utility class for working with Tesseract OCR for captcha recognition\r\n */\r\nexport default class TesseractUtils {\r\n    /**\r\n     * Cleans a captcha image to improve OCR recognition accuracy\r\n     *\r\n     * @param {Buffer} image - The raw captcha image buffer\r\n     * @returns {Promise<Buffer>} A promise that resolves to the cleaned image buffer\r\n     *\r\n     * @example\r\n     * ```typescript\r\n     * // Clean captcha image for better OCR recognition\r\n     * const rawImage = fs.readFileSync('./captcha.png');\r\n     * const cleanedImage = await TesseractUtils.cleanImage(rawImage);\r\n     * ```\r\n     */\r\n    public static async cleanImage(image: Buffer): Promise<Buffer> {\r\n        // Phase 1 - Replace #857069 with #ffffff\r\n        image = await replaceColor({\r\n            image,\r\n            target: \"#857069\",\r\n            replace: \"#ffffff\",\r\n        });\r\n\r\n        // Phase 2 - Replase #ffe4d6 with #ffffff\r\n        image = await replaceColor({\r\n            image,\r\n            target: \"#ffe4d6\",\r\n            replace: \"#ffffff\",\r\n        });\r\n\r\n        // Phase 3 - Cut border by 1px\r\n        image = await cutBorder({\r\n            image,\r\n            borderWidth: 1,\r\n        });\r\n\r\n        return image;\r\n    }\r\n\r\n    /**\r\n     * Recognizes text from a captcha image using Tesseract OCR\r\n     *\r\n     * @param {Buffer} image - The captcha image buffer to process\r\n     * @returns {Promise<string|null>} A promise that resolves to the recognized text, or null if recognition failed\r\n     *\r\n     * @example\r\n     * ```typescript\r\n     * // Recognize text from a captcha image\r\n     * const captchaImage = fs.readFileSync('./captcha.png');\r\n     * const recognizedText = await TesseractUtils.recognizeText(captchaImage);\r\n     *\r\n     * if (recognizedText) {\r\n     *   console.log('Captcha text:', recognizedText);\r\n     * } else {\r\n     *   console.log('Failed to recognize captcha');\r\n     * }\r\n     * ```\r\n     */\r\n    public static async recognizeText(image: Buffer): Promise<string | null> {\r\n        // Clean the image before processing\r\n        image = await this.cleanImage(image);\r\n\r\n        // Recognize text from the image\r\n        const captchaContent = await recognize(image, defaultTesseractConfig);\r\n\r\n        captchaContent.replaceAll(\"\\n\", \"\");\r\n        captchaContent.replaceAll(\" \", \"\");\r\n        captchaContent.slice(0, -1);\r\n\r\n        if ((captchaContent.length !== 6) || !(/^[a-z0-9]+$/i.test(captchaContent))) {\r\n            return null;\r\n        }\r\n\r\n        return captchaContent;\r\n    }\r\n}","/*\r\n * MIT License\r\n *\r\n * Copyright (c) 2025 CookieGMVN and contributors\r\n *\r\n * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n * of this software and associated documentation files (the \"Software\"), to deal\r\n * in the Software without restriction, including without limitation the rights\r\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n * copies of the Software, and to permit persons to whom the Software is\r\n * furnished to do so, subject to the following conditions:\r\n *\r\n * The above copyright notice and this permission notice shall be included in all\r\n * copies or substantial portions of the Software.\r\n *\r\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\n * SOFTWARE.\r\n */\r\n\r\nimport { existsSync, readFileSync, writeFileSync } from \"fs\";\r\nimport { request } from \"undici\";\r\n\r\nimport { defaultHeaders } from \"./Global\";\r\n\r\n/**\r\n * Utility class for managing WebAssembly binary files\r\n */\r\nexport default class WasmUtils {\r\n    /**\r\n     * Downloads the WebAssembly binary from MB Bank's website\r\n     *\r\n     * @returns {Promise<Buffer>} A promise that resolves to the WebAssembly binary buffer\r\n     *\r\n     * @example\r\n     * ```typescript\r\n     * const wasmBinary = await WasmUtils.downloadWasm();\r\n     * // Use the WebAssembly binary for encryption\r\n     * ```\r\n     */\r\n    public static async downloadWasm(): Promise<Buffer> {\r\n        const wasm = await request(\"https://online.mbbank.com.vn/assets/wasm/main.wasm\", {\r\n            headers: defaultHeaders,\r\n        });\r\n\r\n        return Buffer.from(await wasm.body.arrayBuffer());\r\n    }\r\n\r\n    /**\r\n     * Loads WebAssembly binary, either by downloading it or retrieving from disk\r\n     *\r\n     * @param {string} [path] - Optional path to save/load the WebAssembly file\r\n     * @returns {Promise<Buffer>} A promise that resolves to the WebAssembly binary buffer\r\n     *\r\n     * @example\r\n     * ```typescript\r\n     * // Download the WASM file each time\r\n     * const wasmData = await WasmUtils.loadWasm();\r\n     *\r\n     * // Or save/load it from disk for caching\r\n     * const wasmData = await WasmUtils.loadWasm('./cache/main.wasm');\r\n     * ```\r\n     */\r\n    public static async loadWasm(path?: string): Promise<Buffer> {\r\n        if (!path) {\r\n            return this.downloadWasm();\r\n        }\r\n\r\n        if (!existsSync(path)) {\r\n            const wasm = await this.downloadWasm();\r\n\r\n            writeFileSync(path, (wasm as any), { encoding: \"binary\" });\r\n\r\n            return wasm;\r\n        }\r\n\r\n        return Buffer.from(readFileSync(path, \"binary\"), \"binary\");\r\n    }\r\n}"],"mappings":"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","names":["import_moment","import_undici","moment","Jimp","sharp","import_fs","import_undici","path","balanceData","moment"]}